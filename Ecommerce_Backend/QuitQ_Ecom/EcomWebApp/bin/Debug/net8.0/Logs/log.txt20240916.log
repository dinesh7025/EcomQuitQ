2024-09-16 07:59:51,067 INFO  EcomWebApp.Controllers.CartController - Attempting to add a new cart.
2024-09-16 08:06:24,273 INFO  EcomWebApp.Controllers.EcomWebApp.Controllers.OrderController - Placing order for userId: 5, shippingAddressId: 101, billingAddressId: 102, discountCode: SUMMER21, paymentMethod: CreditCard
2024-09-16 08:07:23,765 ERROR EcomWebApp.Controllers.EcomWebApp.Controllers.OrderController - Error occurred while placing the order.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Orders_Addresses_BillingAddressId". The conflict occurred in database "EcomQuitQ", table "dbo.Addresses", column 'AddressId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:f3aace86-4e76-4bf1-bdb4-82a54521317a
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at EcomLib.Repository.OrderRepository.OrderRepository.AddOrderAsync(Order order) in D:\DOTNET FSD Training\CaseStudy\Ecommerce_Backend\QuitQ_Ecom\EcomLib\Repository\OrderRepository\OrderRepository.cs:line 24
   at EcomLib.Service.OrderService.PlaceOrderAsync(Int32 userId, Int32 shippingAddressId, Int32 billingAddressId, String discountCode, PaymentMethod paymentMethod) in D:\DOTNET FSD Training\CaseStudy\Ecommerce_Backend\QuitQ_Ecom\EcomLib\Service\OrderService.cs:line 95
   at EcomWebApp.Controllers.EcomWebApp.Controllers.OrderController.PlaceOrder(PlaceOrderRequestDto orderRequest) in D:\DOTNET FSD Training\CaseStudy\Ecommerce_Backend\QuitQ_Ecom\EcomWebApp\Controllers\OrderController.cs:line 37
2024-09-16 08:10:24,188 INFO  EcomWebApp.Controllers.EcomWebApp.Controllers.OrderController - Placing order for userId: 5, shippingAddressId: 3, billingAddressId: 3, discountCode: SUMMER21, paymentMethod: CreditCard
2024-09-16 08:11:45,606 INFO  EcomWebApp.Controllers.EcomWebApp.Controllers.OrderController - Order placed successfully with OrderId: 3
2024-09-16 08:21:54,214 INFO  EcomWebApp.Controllers.CartController - Attempting to add a new cart.
2024-09-16 08:22:43,515 INFO  EcomWebApp.Controllers.EcomWebApp.Controllers.OrderController - Placing order for userId: 6, shippingAddressId: 4, billingAddressId: 4, discountCode: SUMMER21, paymentMethod: CreditCard
2024-09-16 08:22:44,721 INFO  EcomWebApp.Controllers.EcomWebApp.Controllers.OrderController - Order placed successfully with OrderId: 4
